<!DOCTYPE html>
<html lang="en">

<head>
  <title>Create New Map</title>

  <meta charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0" >

  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" />
  <link rel="stylesheet" href="/vendor/border-box.css" />
  <link rel="stylesheet" href="/styles/main.css" />

  <script src="/vendor/jquery-3.0.0.js"></script>
  <script defer src="/scripts/users.js"></script>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
    integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous" />

  <!-- Font-awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

</head>

<body>
  <%- include("partials/_header") %>
    <h1>Create New Map</h1>
  <div id="map" style="height: 400px;"></div>
  <div class="test">
  <form id="mapForm" enctype="multipart/form-data">
    <label for="mapImage">Image:</label>
    <input type="file" id="mapImage" accept="image/*" href=""><br><br>

    <label for="title">Title:</label>
    <input type="text" id="title" name="title" required><br><br>

    <label for="description">Description:</label>
    <textarea id="description" name="description"></textarea><br><br>

    <label for="city">City:</label>
    <input type="text" id="city" name="city" required><br><br>

    <button type="button" onclick="getLocation()">Submit</button><br><br>
    <input type="submit" value="Done">
  </form>
</div>

  <script>
    // Function to initialize the Leaflet map
    const getMap = (latitude, longitude) => {
      const map = L.map('map').setView([latitude, longitude], 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      L.marker([latitude, longitude]).addTo(map)
        // .bindPopup().openPopup();
    }

    const getLocation = () => {
      const city = document.getElementById('city').value;
      const apiUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(city)}&format=json`;

      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            const latitude = parseFloat(data[0].lat);
            const longitude = parseFloat(data[0].lon);

            // Initialize the map with the obtained coordinates
            getMap(latitude, longitude);
          } else {
            alert('Location not found for the city.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }

    document.getElementById("mapForm").addEventListener("submit", function (event) {
      event.preventDefault(); // Prevent form submission
    });
  </script>
</body>

</html>
